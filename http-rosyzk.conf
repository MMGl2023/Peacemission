NameVirtualHost *:80

#Fix for Apache bug 39499
# http://whitt.wordpress.com/2006/12/11/mongrel-apache-mod_proxy-error/
# http://www.mail-archive.com/users@tomcat.apache.org/msg52090.html
SetEnv force-proxy-request-1.0 1
SetEnv proxy-nokeepalive 1

# <VirtualHost *:80>
#    ServerName rozysk.org
#    ServerAlias *.rozysk.org
#
#    DocumentRoot /home/webmaster/www/rozysk.org
#
#    ScriptAlias /cgi/ "/home/webmaster/cgi/"
#    ScriptAlias /cgi-bin/ "/home/webmaster/cgi/"
#
#    ErrorLog /var/log/httpd/rozysk.org.ru_errors.log
#    CustomLog /var/log/httpd/rozysk.org_custom.log combined
#</VirtualHost>

ExpiresByType text/css "now plus 1 year"
ExpiresByType text/javascript "now plus 1 year"

<VirtualHost *:80>
    ServerAdmin webmaster@rozysk.org
    DocumentRoot /home/webmaster/mmgl/branches/v2.0/public
    ServerName s.rozysk.org
    ErrorLog /var/log/httpd/s.rozysk.org_errors.log
    CustomLog /var/log/httpd/s.rozysk.org_custom.log combined

    <Directory "/home/webmaster/mmgl/branches/v2.0/public">
        Options Indexes FollowSymLinks 
        AllowOverride all
        Order allow,deny
        Allow from all
    </Directory>
    
</VirtualHost>


<VirtualHost *:80>
    ServerAdmin webmaster@rozysk.org
    DocumentRoot /home/webmaster/mmgl/branches/v2.0/public
    ServerName static.rozysk.org
    ErrorLog /var/log/httpd/static.rozysk.org_errors.log
    CustomLog /var/log/httpd/static.rozysk.org_custom.log combined

    <Proxy balancer://static_rozysk_mongrel_cluster>
        BalancerMember http://127.0.0.1:8097 route=127-0-0-1-8097
        BalancerMember http://127.0.0.1:8098 route=127-0-0-1-8098
        BalancerMember http://127.0.0.1:8099 route=127-0-0-1-8099
        BalancerMember http://127.0.0.1:8100 route=127-0-0-1-8100
        BalancerMember http://127.0.0.1:8101 route=127-0-0-1-8101
    </Proxy>

    <Directory "/home/webmaster/mmgl/branches/v2.0/public">
        Options Indexes FollowSymLinks 
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    
    ProxyPass / balancer://static_rozysk_mongrel_cluster/ stickysession=STICKY_ROUTE
</VirtualHost>


<VirtualHost *:80>
    ServerAdmin webmaster@rozysk.org
    DocumentRoot /home/webmaster/mmgl/branches/v2.0/public
    ServerName rozysk.org
    ErrorLog /var/log/httpd/rozysk.org_errors.log
    CustomLog /var/log/httpd/rozysk.org_custom.log common

    <Proxy balancer://rozysk_mongrel_cluster>
        BalancerMember http://127.0.0.1:8097 route=127-0-0-1-8097
        BalancerMember http://127.0.0.1:8098 route=127-0-0-1-8098
        BalancerMember http://127.0.0.1:8099 route=127-0-0-1-8099
        BalancerMember http://127.0.0.1:8100 route=127-0-0-1-8100
        BalancerMember http://127.0.0.1:8101 route=127-0-0-1-8101
    </Proxy>

    <Directory "/home/webmaster/mmgl/branches/v2.0/public">
        Options Indexes FollowSymLinks 
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    
    ProxyPass / balancer://rozysk_mongrel_cluster/ stickysession=STICKY_ROUTE
</VirtualHost>


<VirtualHost *:80>
    ServerAdmin webmaster@rozysk.org
    DocumentRoot /home/webmaster/mmgl/branches/v2.0/public
    ServerName www.rozysk.org
    
    ErrorLog /var/log/httpd/www.rozysk.org_errors.log
    CustomLog /var/log/httpd/www.rozysk.org_custom.log common

    <Proxy balancer://www_rozysk_mongrel_cluster>
        BalancerMember http://127.0.0.1:8097 route=127-0-0-1-8097
        BalancerMember http://127.0.0.1:8098 route=127-0-0-1-8098
        BalancerMember http://127.0.0.1:8099 route=127-0-0-1-8099
        BalancerMember http://127.0.0.1:8100 route=127-0-0-1-8100
        BalancerMember http://127.0.0.1:8101 route=127-0-0-1-8101
    </Proxy>

    #RewriteRule ^$ index.html [QSA]
    #RewriteRule ^([^.]+)$ $1.html [QSA]
    #RewriteCond %{REQUEST_FILENAME} !-f
    #RewriteRule ^(.+)$  http://static.rozysk.org/$1 [P]
    #RewriteCond %{REQUEST_FILENAME} -f
    #RewriteRule .* balancer://www_rozysk_mongrel_cluster%{REQUEST_URI} [P,QSA,L]
    #RewriteCond %{HTTP_COOKIE} !^.*logged_in=yes.*$
    #RewriteRule ^([^.]+)$ $1.html [QSA]
    #RewriteRule ^(.*)$ balancer://www_rozysk_mongrel_cluster%{REQUEST_URI} [P,QSA,L]

    ProxyPass / balancer://www_rozysk_mongrel_cluster/ stickysession=STICKY_ROUTE
</VirtualHost>

